<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Room AI</title>
    <style>
        /* Existing CSS styles */
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #000;
            color: #fff;
            padding: 20px;
            margin: 0;
            transition: background-color 0.3s, color 0.3s;
        }
        #menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            opacity: 1;
            transition: opacity 0.5s;
        }
        #menu.hidden {
            opacity: 0;
        }
        #menu h1 {
            font-size: 36px;
            margin-bottom: 20px;
            font-weight: bold;
        }
        #menu button,
        #input-container button,
        .modal button {
            padding: 15px 20px;
            margin: 10px;
            border: 2px solid #fff;
            border-radius: 5px;
            background-color: transparent;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s;
        }
        #menu button:hover,
        #input-container button:hover,
        .modal button:hover {
            background-color: #444;
            border-color: #666;
        }
        #story-container, #input-container {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            opacity: 0;
            transition: opacity 0.5s;
        }
        #story-container.active, #input-container.active {
            display: flex;
            opacity: 1;
        }
        #story {
            margin-bottom: 20px;
            line-height: 1.6;
        }
        #user-input {
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid #444;
            border-radius: 5px;
            background-color: #222;
            color: #fff;
            font-size: 16px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
        }
        #user-input:focus {
            outline: none;
            border-color: #666;
        }
        #loading {
            display: none;
            margin-top: 10px;
            font-size: 14px;
            font-weight: bold;
            color: #fff;
        }
        .hidden {
            display: none;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #333;
            border: 1px solid #444;
            border-radius: 10px;
            padding: 20px;
            width: 80%;
            max-width: 600px;
            text-align: center;
            color: #fff;
        }
        .modal h2 {
            margin-top: 0;
        }
        .modal button {
            margin-top: 20px;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background-color: #888;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .modal button:hover {
            background-color: #aaa;
        }
        .modal p {
            text-align: left;
        }
        /* New CSS for the dropdown menu */
        #language-selector, #difficulty-selector {
            padding: 10px;
            margin: 10px;
            border: 2px solid #fff;
            border-radius: 5px;
            background-color: #000;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
        }
        #title {
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="menu">
        <h1>Dark Room AI v0.23</h1>
        <button onclick="startGame()" aria-label="Start Game">Start Game</button>
        <button onclick="showModal('aboutModal')" aria-label="About">About</button>
        <button onclick="showModal('instructionsModal')" aria-label="Instructions">Instructions</button>
        <select id="language-selector" aria-label="Language Selector">
            <option id="en" value="English">English</option>
            <option id="de" value="German">German</option>
            <option id="fr" value="French">French</option>
            <option id="es" value="Spanish">Spanish</option>
            <option id="it" value="Italian">Italian</option>
            <option id="jp" value="Japanese">Japanese</option>
            <option id="cn" value="Chinese">Chinese</option>
            <option id="ko" value="Korean">Korean</option>
            <option id="ru" value="Russian">Russian</option>
            <option id="pt" value="Portuguese">Portuguese</option>
            <option id="ar" value="Arabic">Arabic</option>
        </select>
        <select id="difficulty-selector" aria-label="Difficulty Selector">
            <option value="baby easy">Baby Mode</option>
            <option value="easy">Easy</option>
            <option value="medium" selected="true">Medium</option>
            <option value="hard">Hard</option>
        </select>
    </div>
    <div id="story-container">
        <div id="story"></div>
    </div>
    <div id="input-container">
        <input type="text" id="user-input" placeholder="Enter your choice...">
        <button onclick="continueStory()" aria-label="Submit">Submit</button>
        <div id="loading">Loading...</div>
    </div>
    <div id="aboutModal" class="modal">
        <div class="modal-content">
            <h2>About Dark Room AI</h2>
            <p>
                Dark Room AI v0.1 is an interactive scary story experience designed to immerse you in a mysterious narrative guided by an artificial intelligence. You will be faced with various choices and your decisions will direct the path of the story.
            </p>
            <p>
                This project was created by <a href="https://github.com/notBubble" target="_blank" style="color: #bbb;">notBubble</a> on GitHub. It leverages advanced natural language processing capabilities to provide a dynamic and engaging experience. We hope you enjoy the thrill and suspense of unraveling the mysteries within the dark room.
            </p>
            <p>For any feedback or issues, please visit the <a href="https://github.com/notBubble/darkroom" target="_blank" style="color: #bbb;">GitHub repository</a>.</p>
            <button onclick="closeModal('aboutModal')" aria-label="Close">Close</button>
        </div>
    </div>
    <div id="instructionsModal" class="modal">
        <div class="modal-content">
            <h2>Instructions</h2>
            <p>
                Welcome to Dark Room AI! Here is how you can navigate your way through the story:
            </p>
            <ul style="text-align: left; list-style-type: disc; padding-left: 20px;">
                <li>Begin the game by clicking "Start Game".</li>
                <li>Once the story begins, read the prompts carefully.</li>
                <li>Enter your choices into the input box provided. Your choices can include actions like "look around", "pick up the key", or "open the door".</li>
                <li>Click the "Submit" button to send your choice to the AI.</li>
                <li>Based on your input, the AI will generate the next part of the story. Follow along and continue making choices as prompted.</li>
                <li>If you reach an end to the story, you can restart to explore different paths.</li>
            </ul>
            <p>
                Remember, your choices shape the narrative, so think carefully and enjoy the immersive experience!
            </p>
            <button onclick="closeModal('instructionsModal')" aria-label="Close">Close</button>
        </div>
    </div>
    <script>
        const API_URL = "https://reverse.mubi.tech/v1/chat/completions";
        const MODEL = "gpt-4o";

        let chatHistory = [];
        let selectedLanguage = 'English';
        let selectedDifficulty = 'medium';
        const storyDiv = document.getElementById('story');
        storyDiv.innerHTML += `<h1 id="title"><strong>DARK ROOM V0.23</strong></h1>`;
        storyDiv.innerHTML += `<h6 id="title"><strong>> POWERED BY ARTIFICIAL INTELLIGENCE <</strong></h6>`;
        storyDiv.innerHTML += `<p id="title">–––––––––––––––––––––––</p>`;
        
        document.getElementById('language-selector').addEventListener('change', function() {
            selectedLanguage = this.value;
        });

        document.getElementById('difficulty-selector').addEventListener('change', function() {
            selectedDifficulty = this.value;
        });

        function startGame() {
            resetChatHistory();
            document.getElementById('menu').style.display = 'none';
            document.getElementById('story-container').classList.add('active');
            document.getElementById('input-container').classList.add('active');
            initializeStory();
        }

        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function resetChatHistory() {
            chatHistory = [
                {
                    "role": "system",
                    "content": `You are an AI guiding a player through a scary story. Describe the environment, provide options for actions, and handle invalid choices by stating that the action cannot be performed because it doesn't exist. Go down a line after completing a sentence. The character has jeans with pockets to store items he finds. At the start the Investory is emtpy. Display it under the options, just call it Inventory. Answer only in ${selectedLanguage}. Make it ${selectedDifficulty} to escape!`
                }
            ];
        }

        function initializeStory() {
            const initialPrompt = "You are in a dark room, you don't know where you are. Describe the room and provide a list of options for what the player can do next. If the player chooses an option not listed, respond that the item or action cannot be done because it doesn't exist.";
            chatHistory.push({"role": "user", "content": initialPrompt });
            showLoading(true);

            fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: MODEL,
                    messages: chatHistory
                })
            })
            .then(response => response.json())
            .then(data => {
                let aiResponse = data.choices[0].message.content;
                aiResponse = aiResponse.replace(/\n/g, '<br>');
                aiResponse = aiResponse.replace(/\*\*(.*?)\*\*/gs, "<strong>$1</strong>");
                
                chatHistory.push({"role": "assistant", "content": aiResponse});
                displayTextWordByWord(aiResponse);

                showLoading(false);
            })
            .catch(error => {
                console.error('Error:', error);
                showLoading(false);
            });
        }

        function continueStory() {
            const userInput = document.getElementById('user-input').value;
            document.getElementById('user-input').value = '';

            chatHistory.push({"role": "user", "content": userInput });
            storyDiv.innerHTML += `<p id="title">–––––––––––––––––––––––</p>`;
            
            showLoading(true);

            fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: MODEL,
                    messages: chatHistory
                })
            })
            .then(response => response.json())
            .then(data => {
                let aiResponse = data.choices[0].message.content;
                aiResponse = aiResponse.replace(/\n/g, '<br>');
                aiResponse = aiResponse.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");

                chatHistory.push({"role": "assistant", "content": aiResponse});
                displayTextWordByWord(aiResponse);

                showLoading(false);

                if (aiResponse.includes("The End")) {
                    document.getElementById('input-container').style.display = 'none';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showLoading(false);
            });
        } 

        function displayTextWordByWord(text) {
            const storyDiv = document.getElementById('story');
            const words = text.split(' ');
            storyDiv.innerHTML += '<p id="current-text"></p>';
            const currentTextElement = document.getElementById('current-text');
            let index = 0;
            function displayNextWord() {
                if (index < words.length) {
                    currentTextElement.innerHTML += words[index] + ' ';
                    index++;
                    setTimeout(displayNextWord, 5); // Adjust the delay (in milliseconds) as needed
                } else {
                    currentTextElement.removeAttribute('id');
                }
            }
            displayNextWord();
        }

        function showLoading(show) {
            const loadingDiv = document.getElementById('loading');
            loadingDiv.style.display = show ? 'block' : 'none';
        }

        window.onload = function() {
            document.getElementById('menu').classList.remove('hidden');
        }
    </script>
</body>
</html>
